{{> /layout/header}}

<!-- 컨테이너 시작 -->
<div class="container mt-3">
    <input type="hidden" id="id" value="{{post.id}}">



    {{#all}}
    <span class="button gray medium"><a href="#" onclick="lnik(); return false;">URL주소복사</a></span>
    <div class="mb-3">
        작성자 : <a href="/user/other-blog/{{post.user.id}}">{{post.user.username}}</a>
    </div>
    <div class="mb-3 mt-3">
        <h1>{{post.title}}</h1>
    </div>
    <hr />
    <div class="mb-3">
        {{{post.content}}}
    </div>

    {{#pageOwner}}
    <a href="/s/post/{{post.id}}/updateForm" class="btn btn-dark">수정</a>
    <button class="btn btn-danger" id="btn-delete">삭제</button>
    {{/pageOwner}}

    <!-- 상세정보보기 끝 -->

    <!--댓글-->

    <div class="card">
        <form action="/s/post/{{post.Id}}/comment" method="post">
            <div class="card-body">
                <textarea name="content" class="form-control" rows="1"></textarea>
            </div>
            <div class="card-footer">
                <button type="submit" class="btn btn-primary">등록</button>
            </div>
        </form>
    </div>
</div>
<div class="card">
    <div class="card-header"><b>댓글 리스트</b></div>
    <ul id="reply-box" class="list-group">

        {{#comments}}
        <li class="list-group-item d-flex justify-content-between">
            <div>{{comment.content}}</div>
            <div class="d-flex">
                <div class="font-italic">작성자 : {{post.user.username}} &nbsp;</div>
                {{#auth}}
                <button class="badge bg-primary" onclick="deleteComment('{{comment.id}}');">삭제</button>
                {{/auth}}
            </div>
        </li>
        {{/comments}}

    </ul>
</div>
{{/all}}
{{^all}}
{{#secret}}
비공개글입니다.
{{/secret}}
{{^secret}}
<span class="button gray medium"><a href="#" onclick="lnik(); return false;">URL주소복사</a></span>
<div class="mb-3">
    작성자 : <a href="/user/other-blog/{{post.user.id}}">{{post.user.username}}</a>
</div>
<div class="mb-3 mt-3">
    <h1>{{post.title}}</h1>
</div>
<hr />
<div class="mb-3">
    {{{post.content}}}
</div>
{{#pageOwner}}
<a href="/s/post/{{post.id}}/updateForm" class="btn btn-dark">수정</a>
<button class="btn btn-danger" id="btn-delete">삭제</button>
{{/pageOwner}}

<!-- 상세정보보기 끝 -->

<!--댓글-->

<div class="card">
    <form action="/s/post/{{post.Id}}/comment" method="post">
        <div class="card-body">
            <textarea name="content" class="form-control" rows="1"></textarea>
        </div>
        <div class="card-footer">
            <button type="submit" class="btn btn-primary">등록</button>
        </div>
    </form>
</div>
</div>


<div class="card">
    <div class="card-header"><b>댓글 리스트</b></div>
    <ul id="reply-box" class="list-group">

        {{#comments}}
        <li class="list-group-item d-flex justify-content-between">
            <div>{{comment.content}}</div>
            <div class="d-flex">
                <div class="font-italic">작성자 : {{post.user.username}} &nbsp;</div>
                {{#auth}}
                <button class="badge bg-primary" onclick="deleteComment('{{comment.id}}');">삭제</button>
                {{/auth}}
            </div>
        </li>
        {{/comments}}

    </ul>
</div>
{{/secret}}
{{/all}}



<br />
<!-- 컨테이너 끝 -->


<script>
    async function deleteById() {
        let id = $("#id").val();
        let response = await fetch("/s/post/" + id, {
            method: "DELETE"
        });
        let responseObject = await response.json();
        if (responseObject.code == 1) {
            alert("삭제성공");
            location.href = "/";
        } else {
            alert("삭제실패");
            console.log(responseObject.msg);
        }
    }
    $("#btn-delete").click((event) => {
        // DELETE, /post/{id}
        deleteById();
    });


    async function deleteComment(commentId) {
        let response = await fetch(`/s/api/comment/${commentId}`, {
            method: "DELETE"
        });
        let responseParse = await response.json();
        if (responseParse.code == 1) {
            alert("삭제 성공");
            location.reload(); // ajax + ssr
        } else {
            alert("삭제 실패");
        }
    }

</script>

<script type="text/javascript">

    function link() {

        var url = '';
        var textarea = document.createElement("textarea");
        document.body.appendChild(textarea);
        url = window.document.location.href;
        textarea.value = url;
        textarea.select();
        document.execCommand("copy");
        document.body.removeChild(textarea);
        alert("URL이 복사되었습니다.")
    }

</script>
{{> /layout/footer}}